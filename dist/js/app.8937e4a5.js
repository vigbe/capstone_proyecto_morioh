(function(){"use strict";var i={520:function(i,e,t){var o=t(751),r=t(641);const a={id:"app"};function l(i,e,t,o,l,s){const n=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",a,[(0,r.bF)(n)])}var s={name:"App"},n=t(621);const d=(0,n.A)(s,[["render",l],["__scopeId","data-v-4c2d7571"]]);var c=d,u=t(220);function p(i,e,t,o,a,l){const s=(0,r.g2)("NavBar");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(s),e[0]||(e[0]=(0,r.Fv)('<div class="home" data-v-cd8930a6><div class="solicitudes-container" data-v-cd8930a6><h2 data-v-cd8930a6>Solicitudes</h2><div class="canvas-table" data-v-cd8930a6><table data-v-cd8930a6><thead data-v-cd8930a6><tr data-v-cd8930a6><th data-v-cd8930a6>ID</th><th data-v-cd8930a6>Nombre del Cliente</th><th data-v-cd8930a6>Fecha de Solicitud</th><th data-v-cd8930a6>Estado</th></tr></thead><tbody data-v-cd8930a6><tr data-v-cd8930a6><td data-v-cd8930a6>1</td><td data-v-cd8930a6>Juan Pérez</td><td data-v-cd8930a6>2024-10-15</td><td data-v-cd8930a6>Pendiente</td></tr><tr data-v-cd8930a6><td data-v-cd8930a6>2</td><td data-v-cd8930a6>Ana Gómez</td><td data-v-cd8930a6>2024-10-16</td><td data-v-cd8930a6>En Proceso</td></tr></tbody></table></div></div></div>',1))],64)}var m=t(230);const h="https://fryyhsdjtmuqakazrirz.supabase.co",b="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyeXloc2RqdG11cWFrYXpyaXJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjU0MTg0ODEsImV4cCI6MjA0MDk5NDQ4MX0.bwkZKDcO6094qBr-4qSrh0ksT-5WUROSQZqpSn0h5f0",f=(0,m.UU)(h,b);var k=f,v=t(33);const _={class:"nav-bar"},g={class:"user-info-container"},L={class:"user-info"},y={class:"menu-container"},w={class:"menu-items"};function C(i,e,t,o,a,l){const s=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("nav",_,[(0,r.Lk)("div",g,[(0,r.Lk)("div",L,[(0,r.Lk)("span",null,(0,v.v_)(a.userName)+" ("+(0,v.v_)(a.userType)+")",1)]),e[1]||(e[1]=(0,r.Lk)("div",{class:"company-name"},[(0,r.Lk)("span",null,"LUVI Brokers")],-1))]),(0,r.Lk)("div",y,[(0,r.Lk)("div",w,[(0,r.bF)(s,{to:"/solicitudes",class:"menu-item"},{default:(0,r.k6)((()=>e[2]||(e[2]=[(0,r.eW)("Solicitudes")]))),_:1}),(0,r.bF)(s,{to:"/marketplace",class:"menu-item"},{default:(0,r.k6)((()=>e[3]||(e[3]=[(0,r.eW)("Marketplace")]))),_:1}),(0,r.bF)(s,{to:"/clientes",class:"menu-item"},{default:(0,r.k6)((()=>e[4]||(e[4]=[(0,r.eW)("Clientes")]))),_:1}),"Inmobiliaria"===a.userType?((0,r.uX)(),(0,r.Wv)(s,{key:0,to:"/cargar-propiedades",class:"menu-item"},{default:(0,r.k6)((()=>e[5]||(e[5]=[(0,r.eW)("Cargar Propiedades")]))),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{onClick:e[0]||(e[0]=(...i)=>l.logout&&l.logout(...i)),class:"logout-button"},"Cerrar Sesión")])])}var E={data(){return{userName:"",userType:"",id_broker:null,id_inmobiliaria:null}},async created(){const i=JSON.parse(localStorage.getItem("user"));i&&i.id?await this.fetchUserData(i.id):this.$router.push({name:"Login"})},methods:{async fetchUserData(i){try{const{data:e,error:t}=await k.from("broker").select("*").eq("user_id",i).single();if(t)throw t;if(e)return this.userName=e.nombre,this.userType="Broker",void(this.id_broker=e.id_broker)}catch(e){console.error("Error fetching broker data:",e.message)}try{const{data:e,error:t}=await k.from("inmobiliaria").select("*").eq("user_id",i).single();if(t)throw t;e&&(this.userName=e.nombre,this.userType="Inmobiliaria",this.id_inmobiliaria=e.id_inmobiliaria)}catch(e){console.error("Error fetching inmobiliaria data:",e.message)}},async logout(){const{error:i}=await k.auth.signOut();i?console.error("Error al cerrar sesión:",i.message):(localStorage.removeItem("user"),this.$router.push({name:"Login"}))}}};const S=(0,n.A)(E,[["render",C],["__scopeId","data-v-02ebbdc4"]]);var I=S,A={components:{NavBar:I},data(){return{userName:"",userType:""}},async created(){const i=JSON.parse(localStorage.getItem("user"));i&&i.id?await this.fetchUserData(i.id):this.$router.push({name:"Login"})},methods:{async fetchUserData(i){try{let{data:e,error:t}=await k.from("broker").select("*").eq("user_id",i).single();if(t)throw t;if(e)return this.userName=e.nombre,void(this.userType="Broker")}catch(e){console.error("Error fetching user data:",e.message)}try{let{data:e,error:t}=await k.from("inmobiliaria").select("*").eq("user_id",i).single();if(t)throw t;e&&(this.userName=e.nombre,this.userType="Inmobiliaria")}catch(e){console.error("Error fetching user data:",e.message)}},async logout(){const{error:i}=await k.auth.signOut();i?console.error("Error al cerrar sesión:",i.message):(localStorage.removeItem("user"),this.$router.push({name:"Login"}))}}};const F=(0,n.A)(A,[["render",p],["__scopeId","data-v-cd8930a6"]]);var O=F;const U={class:"login"},X={class:"form-submit-container"},q={key:0,class:"loader"},D={key:1,class:"success-message"},N={key:0,class:"error-message"},T={class:"form-link"};function R(i,e,t,a,l,s){const n=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",U,[e[9]||(e[9]=(0,r.Lk)("div",{class:"title-container"},[(0,r.Lk)("h1",{class:"title"},"Inicia sesión")],-1)),(0,r.Lk)("form",{onSubmit:e[2]||(e[2]=(0,o.D$)(((...i)=>s.login&&s.login(...i)),["prevent"])),class:"form"},[e[7]||(e[7]=(0,r.Lk)("label",{class:"form-label",for:"email"},"Correo Electrónico:",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"email",id:"email","onUpdate:modelValue":e[0]||(e[0]=i=>l.email=i),required:"",placeholder:"Correo Electrónico"},null,512),[[o.Jo,l.email]]),e[8]||(e[8]=(0,r.Lk)("label",{class:"form-label",for:"password"},"Contraseña:",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=i=>l.password=i),required:"",placeholder:"Contraseña"},null,512),[[o.Jo,l.password]]),(0,r.Lk)("div",X,[e[4]||(e[4]=(0,r.Lk)("input",{class:"form-submit",type:"submit",value:"Login"},null,-1)),l.loading?((0,r.uX)(),(0,r.CE)("div",q)):(0,r.Q3)("",!0),l.loginSuccess?((0,r.uX)(),(0,r.CE)("div",D,e[3]||(e[3]=[(0,r.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,r.eW)(" Login exitoso ")]))):(0,r.Q3)("",!0)]),l.errorMessage?((0,r.uX)(),(0,r.CE)("div",N,(0,v.v_)(l.errorMessage),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",T,[(0,r.Lk)("label",null,[e[6]||(e[6]=(0,r.eW)("¿No tienes una cuenta? ")),(0,r.bF)(n,{to:"/registro"},{default:(0,r.k6)((()=>e[5]||(e[5]=[(0,r.eW)("Regístrate aquí")]))),_:1})])])],32)])}var P={data(){return{email:"",password:"",errorMessage:"",loading:!1,loginSuccess:!1}},methods:{async login(){this.loading=!0,this.errorMessage="",this.loginSuccess=!1;try{const{data:{user:i,session:e},error:t}=await k.auth.signInWithPassword({email:this.email,password:this.password});if(t)throw t;const o=i.id;if(localStorage.setItem("user",JSON.stringify({id:o})),t)throw t;localStorage.setItem("user",JSON.stringify(i)),this.loginSuccess=!0,this.loading=!1,setTimeout((()=>{this.$router.push({name:"Home"})}),1500)}catch(i){this.errorMessage=`Error en la autenticación: ${i.message}`,this.loading=!1,console.error(i)}}}};const z=(0,n.A)(P,[["render",R],["__scopeId","data-v-0d22f90f"]]);var $=z;const J={class:"register"},V={class:"form-submit-container"},W={key:0,class:"loader"},M={key:1,class:"success-message"},j={key:0,class:"error-message"},B={class:"form-link"};function x(i,e,t,a,l,s){const n=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",J,[e[11]||(e[11]=(0,r.Lk)("div",{class:"title-container"},[(0,r.Lk)("h1",{class:"title"},"Registro de Usuario")],-1)),(0,r.Lk)("form",{onSubmit:e[3]||(e[3]=(0,o.D$)(((...i)=>s.register&&s.register(...i)),["prevent"])),class:"form"},[e[8]||(e[8]=(0,r.Lk)("label",{class:"form-label",for:"email"},"Correo Electrónico",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"email",id:"email","onUpdate:modelValue":e[0]||(e[0]=i=>l.email=i),required:"",placeholder:"Correo Electrónico"},null,512),[[o.Jo,l.email]]),e[9]||(e[9]=(0,r.Lk)("label",{class:"form-label",for:"password"},"Contraseña",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=i=>l.password=i),required:"",placeholder:"Contraseña"},null,512),[[o.Jo,l.password]]),e[10]||(e[10]=(0,r.Lk)("label",{class:"form-label",for:"confirmPassword"},"Confirmar Contraseña",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"password",id:"confirmPassword","onUpdate:modelValue":e[2]||(e[2]=i=>l.confirmPassword=i),required:"",placeholder:"Confirmar Contraseña"},null,512),[[o.Jo,l.confirmPassword]]),(0,r.Lk)("div",V,[e[5]||(e[5]=(0,r.Lk)("input",{class:"form-submit",type:"submit",value:"Registrar"},null,-1)),l.loading?((0,r.uX)(),(0,r.CE)("div",W)):(0,r.Q3)("",!0),l.registerSuccess?((0,r.uX)(),(0,r.CE)("div",M,e[4]||(e[4]=[(0,r.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,r.eW)(" Registro exitoso ")]))):(0,r.Q3)("",!0)]),l.errorMessage?((0,r.uX)(),(0,r.CE)("div",j,(0,v.v_)(l.errorMessage),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",B,[(0,r.Lk)("label",null,[e[7]||(e[7]=(0,r.eW)("¿Ya tienes una cuenta? ")),(0,r.bF)(n,{to:"/"},{default:(0,r.k6)((()=>e[6]||(e[6]=[(0,r.eW)("Inicia sesión aquí")]))),_:1})])])],32)])}var Q={data(){return{email:"",password:"",confirmPassword:"",errorMessage:"",loading:!1,registerSuccess:!1}},methods:{async register(){if(this.loading=!0,this.errorMessage="",this.registerSuccess=!1,this.password!==this.confirmPassword)return this.errorMessage="Las contraseñas no coinciden.",void(this.loading=!1);try{const{data:i,error:e}=await k.auth.signUp({email:this.email,password:this.password});if(e)throw e;const t=i.user?.id;t&&localStorage.setItem("user",JSON.stringify({id:t,email:this.email,password:this.password})),this.registerSuccess=!0,this.loading=!1,setTimeout((()=>{this.$router&&this.$router.push({name:"Login"})}),1500)}catch(i){this.errorMessage=`Error en el registro: ${i.message}`,this.loading=!1,console.error(i)}}}};const K=(0,n.A)(Q,[["render",x],["__scopeId","data-v-bbc22966"]]);var Z=K;const G={class:"register-complete"},Y={class:"form-group"},H={key:0},ii={class:"form-group"},ei={class:"form-group"},ti={class:"form-group"},oi={key:1},ri={class:"form-group"},ai={class:"form-group"},li={class:"form-group"},si={class:"form-submit-container"},ni={key:0,class:"loader"},di={key:1,class:"success-message"},ci={key:2,class:"error-message"};function ui(i,e,t,a,l,s){return(0,r.uX)(),(0,r.CE)("div",G,[e[18]||(e[18]=(0,r.Lk)("div",{class:"title-container"},[(0,r.Lk)("h1",{class:"title"},"Completar Registro")],-1)),(0,r.Lk)("form",{onSubmit:e[7]||(e[7]=(0,o.D$)(((...i)=>s.completeRegistration&&s.completeRegistration(...i)),["prevent"])),class:"form"},[(0,r.Lk)("div",Y,[e[9]||(e[9]=(0,r.Lk)("label",{class:"form-label",for:"tipoUsuario"},"Tipo de Usuario",-1)),(0,r.bo)((0,r.Lk)("select",{class:"form-input",id:"tipoUsuario","onUpdate:modelValue":e[0]||(e[0]=i=>l.tipoUsuario=i),required:""},e[8]||(e[8]=[(0,r.Lk)("option",{value:""},"Seleccione una opción",-1),(0,r.Lk)("option",{value:"broker"},"Broker",-1),(0,r.Lk)("option",{value:"inmobiliaria"},"Inmobiliaria",-1)]),512),[[o.u1,l.tipoUsuario]])]),"broker"===l.tipoUsuario?((0,r.uX)(),(0,r.CE)("div",H,[(0,r.Lk)("div",ii,[e[10]||(e[10]=(0,r.Lk)("label",{class:"form-label",for:"nombre"},"Nombre",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"text",id:"nombre","onUpdate:modelValue":e[1]||(e[1]=i=>l.nombre=i),required:"",placeholder:"Nombre"},null,512),[[o.Jo,l.nombre]])]),(0,r.Lk)("div",ei,[e[11]||(e[11]=(0,r.Lk)("label",{class:"form-label",for:"empresa"},"Empresa",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"text",id:"empresa","onUpdate:modelValue":e[2]||(e[2]=i=>l.empresa=i),required:"",placeholder:"Empresa"},null,512),[[o.Jo,l.empresa]])]),(0,r.Lk)("div",ti,[e[12]||(e[12]=(0,r.Lk)("label",{class:"form-label",for:"telefono"},"Teléfono",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"text",id:"telefono","onUpdate:modelValue":e[3]||(e[3]=i=>l.telefono=i),required:"",placeholder:"Teléfono"},null,512),[[o.Jo,l.telefono]])])])):(0,r.Q3)("",!0),"inmobiliaria"===l.tipoUsuario?((0,r.uX)(),(0,r.CE)("div",oi,[(0,r.Lk)("div",ri,[e[13]||(e[13]=(0,r.Lk)("label",{class:"form-label",for:"nombreInmobiliaria"},"Nombre de la Inmobiliaria",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"text",id:"nombreInmobiliaria","onUpdate:modelValue":e[4]||(e[4]=i=>l.nombreInmobiliaria=i),required:"",placeholder:"Nombre de la Inmobiliaria"},null,512),[[o.Jo,l.nombreInmobiliaria]])]),(0,r.Lk)("div",ai,[e[14]||(e[14]=(0,r.Lk)("label",{class:"form-label",for:"direccion"},"Dirección",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"text",id:"direccion","onUpdate:modelValue":e[5]||(e[5]=i=>l.direccion=i),required:"",placeholder:"Dirección"},null,512),[[o.Jo,l.direccion]])]),(0,r.Lk)("div",li,[e[15]||(e[15]=(0,r.Lk)("label",{class:"form-label",for:"telefonoInmobiliaria"},"Teléfono",-1)),(0,r.bo)((0,r.Lk)("input",{class:"form-input",type:"text",id:"telefonoInmobiliaria","onUpdate:modelValue":e[6]||(e[6]=i=>l.telefonoInmobiliaria=i),required:"",placeholder:"Teléfono"},null,512),[[o.Jo,l.telefonoInmobiliaria]])])])):(0,r.Q3)("",!0),(0,r.Lk)("div",si,[e[17]||(e[17]=(0,r.Lk)("input",{class:"form-submit",type:"submit",value:"Completar Registro"},null,-1)),l.loading?((0,r.uX)(),(0,r.CE)("div",ni)):(0,r.Q3)("",!0),l.registerSuccess?((0,r.uX)(),(0,r.CE)("div",di,e[16]||(e[16]=[(0,r.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,r.eW)(" Registro completado con éxito ")]))):(0,r.Q3)("",!0)]),l.errorMessage?((0,r.uX)(),(0,r.CE)("div",ci,(0,v.v_)(l.errorMessage),1)):(0,r.Q3)("",!0)],32)])}var pi={data(){return{tipoUsuario:"",nombre:"",empresa:"",telefono:"",nombreInmobiliaria:"",direccion:"",telefonoInmobiliaria:"",errorMessage:"",loading:!1,registerSuccess:!1}},methods:{async completeRegistration(){this.loading=!0,this.errorMessage="",this.registerSuccess=!1;try{const i=JSON.parse(localStorage.getItem("user"));if(!i||!i.id)throw new Error("Usuario no encontrado. Inicie sesión nuevamente.");let e;if("broker"===this.tipoUsuario){const{error:t}=await k.from("broker").insert({user_id:i.id,email:i.email,nombre:this.nombre,empresa:this.empresa,telefono:this.telefono,fecha_registro:new Date});e=t}else if("inmobiliaria"===this.tipoUsuario){const{error:t}=await k.from("inmobiliaria").insert({user_id:i.id,email:i.email,nombre:this.nombreInmobiliaria,direccion:this.direccion,telefono:this.telefonoInmobiliaria,fecha_registro:new Date});e=t}if(e)throw e;this.registerSuccess=!0,this.loading=!1,setTimeout((()=>{this.$router&&this.$router.push({name:"Home"})}),1500)}catch(i){this.errorMessage=`Error en el registro completo: ${i.message}`,this.loading=!1,console.error(i)}}}};const mi=(0,n.A)(pi,[["render",ui],["__scopeId","data-v-fa112e6c"]]);var hi=mi;const bi={class:"marketplace"},fi={class:"filters"},ki={class:"propiedades-list"},vi={key:0,class:"loading"},_i={key:1,class:"no-results"},gi={class:"propiedad-image"},Li={key:0,class:"carousel-wrapper"},yi=["src","alt"],wi={key:0,class:"swiper-pagination"},Ci={class:"propiedad-info"};function Ei(i,e,t,a,l,s){const n=(0,r.g2)("NavBar"),d=(0,r.g2)("swiper-slide"),c=(0,r.g2)("swiper");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(n),(0,r.Lk)("div",bi,[(0,r.Lk)("div",fi,[e[8]||(e[8]=(0,r.Lk)("h2",null,"Filtros",-1)),(0,r.Lk)("label",null,[e[5]||(e[5]=(0,r.eW)(" Tipo de Propiedad: ")),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>l.filters.tipo=i)},e[4]||(e[4]=[(0,r.Lk)("option",{value:""},"Todos",-1),(0,r.Lk)("option",{value:"Casa"},"Casa",-1),(0,r.Lk)("option",{value:"Departamento"},"Departamento",-1)]),512),[[o.u1,l.filters.tipo]])]),(0,r.Lk)("label",null,[e[6]||(e[6]=(0,r.eW)(" Precio Máximo: ")),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=i=>l.filters.precioMaximo=i),placeholder:"Ej: 1000000"},null,512),[[o.Jo,l.filters.precioMaximo]])]),(0,r.Lk)("label",null,[e[7]||(e[7]=(0,r.eW)(" Ubicación: ")),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=i=>l.filters.ubicacion=i),placeholder:"Ej: Santiago"},null,512),[[o.Jo,l.filters.ubicacion]])]),(0,r.Lk)("button",{onClick:e[3]||(e[3]=(...i)=>s.aplicarFiltros&&s.aplicarFiltros(...i))},"Aplicar Filtros")]),(0,r.Lk)("div",ki,[l.loading?((0,r.uX)(),(0,r.CE)("div",vi,"Cargando propiedades...")):0===l.propiedades.length?((0,r.uX)(),(0,r.CE)("div",_i,"No se encontraron propiedades.")):((0,r.uX)(!0),(0,r.CE)(r.FK,{key:2},(0,r.pI)(s.propiedadesFiltradas,(i=>((0,r.uX)(),(0,r.CE)("div",{class:"propiedad",key:i.id},[(0,r.Lk)("div",gi,[i.fotos&&i.fotos.length>0?((0,r.uX)(),(0,r.CE)("div",Li,[(0,r.bF)(c,{options:l.options},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.fotos,((i,e)=>((0,r.uX)(),(0,r.Wv)(d,{key:e},{default:(0,r.k6)((()=>[(0,r.Lk)("img",{src:i.url,alt:i.descripcion},null,8,yi)])),_:2},1024)))),128)),i.fotos.length>1?((0,r.uX)(),(0,r.CE)("div",wi)):(0,r.Q3)("",!0)])),_:2},1032,["options"])])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Ci,[(0,r.Lk)("h3",null,(0,v.v_)(i.titulo),1),(0,r.Lk)("p",null,(0,v.v_)(i.descripcion),1),(0,r.Lk)("p",null,"Precio: "+(0,v.v_)(i.precio),1),(0,r.Lk)("p",null,"Ubicación: "+(0,v.v_)(i.ubicacion),1)])])))),128))])])],64)}var Si=t(303),Ii={components:{NavBar:I},data(){return{propiedades:[],filters:{tipo:"",precioMaximo:"",ubicacion:""},loading:!0,options:{slidesPerView:1,spaceBetween:10,pagination:{el:".swiper-pagination",clickable:!0},loop:!0}}},computed:{propiedadesFiltradas(){return this.propiedades.filter((i=>(!this.filters.tipo||i.tipo===this.filters.tipo)&&(!this.filters.precioMaximo||i.precio<=this.filters.precioMaximo)&&(!this.filters.ubicacion||i.ubicacion.toLowerCase().includes(this.filters.ubicacion.toLowerCase()))))}},async created(){await this.fetchPropiedades()},methods:{async fetchPropiedades(){try{const{data:i,error:e}=await k.from("propiedad").select("*, foto(*)");if(e)throw e;console.log("Fetched propiedades:",i),this.propiedades=i.map((i=>({...i,fotos:i.foto?Array.isArray(i.foto)?i.foto:[i.foto]:[]})))}catch(i){console.error("Error al obtener propiedades:",i.message)}finally{this.loading=!1}},aplicarFiltros(){}},components:{Swiper:Si.RC,SwiperSlide:Si.qr}};const Ai=(0,n.A)(Ii,[["render",Ei],["__scopeId","data-v-233e294a"]]);var Fi=Ai,Oi=t.p+"img/edit-icon.a81d0bad.png",Ui=t.p+"img/ver-icon.a4f89159.png",Xi=t.p+"img/delete-icon.ffc2a42f.png";const qi={class:"solicitudes"},Di={class:"table-container"},Ni={class:"solicitudes-table"},Ti=["onClick"],Ri=["onClick"],Pi=["onClick"],zi={class:"add-solicitud-container"};function $i(i,e,t,o,a,l){const s=(0,r.g2)("NavBar"),n=(0,r.g2)("EditFormSolicitud");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(s),(0,r.Lk)("div",qi,[(0,r.Lk)("div",Di,[e[3]||(e[3]=(0,r.Lk)("h2",null,"Solicitudes",-1)),(0,r.Lk)("table",Ni,[e[2]||(e[2]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"ID Solicitud"),(0,r.Lk)("th",null,"Fecha de Solicitud"),(0,r.Lk)("th",null,"Estado"),(0,r.Lk)("th",null,"Tipo"),(0,r.Lk)("th",null,"Broker"),(0,r.Lk)("th",null,"Cliente"),(0,r.Lk)("th",null,"Inmobiliaria"),(0,r.Lk)("th",null,"Propiedad"),(0,r.Lk)("th",null,"Acciones")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.tasks,(i=>((0,r.uX)(),(0,r.CE)("tr",{key:i.id},[(0,r.Lk)("td",null,(0,v.v_)(i.id_solicitud),1),(0,r.Lk)("td",null,(0,v.v_)(i.fecha_solicitud),1),(0,r.Lk)("td",null,(0,v.v_)(i.estado),1),(0,r.Lk)("td",null,(0,v.v_)(i.tipo),1),(0,r.Lk)("td",null,(0,v.v_)(i.broker_nombre),1),(0,r.Lk)("td",null,(0,v.v_)(i.cliente_nombre),1),(0,r.Lk)("td",null,(0,v.v_)(i.inmobiliaria_nombre),1),(0,r.Lk)("td",null,(0,v.v_)(i.propiedad_titulo),1),(0,r.Lk)("td",null,[(0,r.Lk)("img",{src:Oi,alt:"Editar",title:"Editar",class:"action-icon",onClick:e=>l.editSolicitud(i)},null,8,Ti),(0,r.Lk)("img",{src:Ui,alt:"Ver",title:"Ver",class:"action-icon",onClick:e=>l.viewSolicitud(i.id_solicitud)},null,8,Ri),(0,r.Lk)("img",{src:Xi,alt:"Eliminar",title:"Eliminar",class:"action-icon",onClick:e=>l.deleteSolicitud(i.id)},null,8,Pi)])])))),128))])])]),(0,r.Lk)("div",zi,[(0,r.Lk)("button",{class:"add-solicitud-button",onClick:e[0]||(e[0]=(...i)=>l.openAddSolicitudForm&&l.openAddSolicitudForm(...i))},"Agregar Solicitud")]),(0,r.bF)(n,{visible:a.showOverlay,isEditing:a.isEditing,solicitudData:a.newSolicitud,clientes:a.clientes,brokers:a.brokers,inmobiliarias:a.inmobiliarias,propiedades:a.propiedades,userType:a.userType,onClose:e[1]||(e[1]=i=>a.showOverlay=!1),onAddSolicitud:l.addSolicitud,onUpdateSolicitud:l.updateSolicitud},null,8,["visible","isEditing","solicitudData","clientes","brokers","inmobiliarias","propiedades","userType","onAddSolicitud","onUpdateSolicitud"])])],64)}const Ji={key:0,class:"overlay"},Vi={class:"overlay-content"},Wi={class:"form-group"},Mi={class:"form-group"},ji=["value"],Bi={class:"form-group"},xi=["value"],Qi={class:"form-group"},Ki=["value"],Zi={class:"form-group"},Gi=["value"],Yi={class:"form-group"},Hi={type:"submit"};function ie(i,e,t,a,l,s){return t.visible?((0,r.uX)(),(0,r.CE)("div",Ji,[(0,r.Lk)("div",Vi,[(0,r.Lk)("h3",null,(0,v.v_)(t.isEditing?"Editar Solicitud":"Nueva Solicitud"),1),(0,r.Lk)("form",{onSubmit:e[8]||(e[8]=(0,o.D$)(((...i)=>s.submitForm&&s.submitForm(...i)),["prevent"]))},[(0,r.Lk)("div",Wi,[e[10]||(e[10]=(0,r.Lk)("label",{for:"tipo"},"Tipo de Solicitud",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>l.solicitud.tipo=i),id:"tipo",required:"",onChange:e[1]||(e[1]=(...i)=>s.handleTipoChange&&s.handleTipoChange(...i))},e[9]||(e[9]=[(0,r.Lk)("option",{disabled:"",value:""},"Seleccione un tipo",-1),(0,r.Lk)("option",{value:"Nuevo Cliente"},"Nuevo Cliente",-1),(0,r.Lk)("option",{value:"Venta"},"Venta",-1),(0,r.Lk)("option",{value:"Agendamiento"},"Agendamiento",-1)]),544),[[o.u1,l.solicitud.tipo]])]),(0,r.Lk)("div",Mi,[e[12]||(e[12]=(0,r.Lk)("label",{for:"cliente"},"Cliente",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[2]||(e[2]=i=>l.solicitud.cliente_id=i),id:"id_cliente",required:""},[e[11]||(e[11]=(0,r.Lk)("option",{disabled:"",value:""},"Seleccione un cliente",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.clientes,(i=>((0,r.uX)(),(0,r.CE)("option",{key:i.id_cliente,value:i.id_cliente},(0,v.v_)(i.nombre)+" "+(0,v.v_)(i.apellido),9,ji)))),128))],512),[[o.u1,l.solicitud.cliente_id]])]),(0,r.Lk)("div",Bi,[e[14]||(e[14]=(0,r.Lk)("label",{for:"inmobiliaria"},"Inmobiliaria",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>l.solicitud.id_inmobiliaria=i),id:"id_inmobiliaria",onChange:e[4]||(e[4]=(...i)=>s.filterProperties&&s.filterProperties(...i)),required:""},[e[13]||(e[13]=(0,r.Lk)("option",{disabled:"",value:""},"Seleccione una inmobiliaria",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.inmobiliarias,(i=>((0,r.uX)(),(0,r.CE)("option",{key:i.id_inmobiliaria,value:i.id_inmobiliaria},(0,v.v_)(i.nombre),9,xi)))),128))],544),[[o.u1,l.solicitud.id_inmobiliaria]])]),"Venta"===l.solicitud.tipo||"Agendamiento"===l.solicitud.tipo?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("div",Qi,[e[16]||(e[16]=(0,r.Lk)("label",{for:"broker"},"Broker",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[5]||(e[5]=i=>l.solicitud.id_broker=i),id:"id_broker",required:""},[e[15]||(e[15]=(0,r.Lk)("option",{disabled:"",value:""},"Seleccione un broker",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.brokers,(i=>((0,r.uX)(),(0,r.CE)("option",{key:i.id_broker,value:i.id_broker},(0,v.v_)(i.nombre),9,Ki)))),128))],512),[[o.u1,l.solicitud.id_broker]])]),(0,r.Lk)("div",Zi,[e[18]||(e[18]=(0,r.Lk)("label",{for:"propiedad"},"Propiedad",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>l.solicitud.id_propiedad=i),id:"id_propiedad",required:""},[e[17]||(e[17]=(0,r.Lk)("option",{disabled:"",value:""},"Seleccione una propiedad",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.filteredProperties,(i=>((0,r.uX)(),(0,r.CE)("option",{key:i.id_propiedad,value:i.id_propiedad},(0,v.v_)(i.titulo),9,Gi)))),128))],512),[[o.u1,l.solicitud.id_propiedad]])])],64)):(0,r.Q3)("",!0),(0,r.Lk)("div",Yi,[(0,r.Lk)("button",Hi,(0,v.v_)(t.isEditing?"Guardar Cambios":"Agregar Solicitud"),1),(0,r.Lk)("button",{type:"button",onClick:e[7]||(e[7]=e=>i.$emit("close"))},"Cancelar")])],32)])])):(0,r.Q3)("",!0)}var ee={props:{visible:Boolean,isEditing:Boolean,solicitudData:Object,clientes:Array,brokers:Array,inmobiliarias:Array,propiedades:Array,userType:String},data(){return{solicitud:{tipo:"",id_cliente:null,id_broker:null,id_inmobiliaria:null,id_propiedad:null},filteredProperties:[]}},watch:{solicitudData:{immediate:!0,handler(i){this.isEditing?(this.solicitud={...i},console.log(i)):this.isEditing||(this.solicitud={tipo:"",id_cliente:null,id_broker:null,id_inmobiliaria:null,id_propiedad:null})}}},methods:{handleTipoChange(){"Nuevo Cliente"===this.solicitud.tipo&&(this.solicitud.id_broker=null,this.solicitud.id_inmobiliaria=null,this.solicitud.id_propiedad=null)},filterProperties(){this.filteredProperties=this.propiedades.filter((i=>i.id_inmobiliaria===this.solicitud.id_inmobiliaria))},submitForm(){this.$emit(this.isEditing?"update-solicitud":"add-solicitud",{...this.solicitud})}}};const te=(0,n.A)(ee,[["render",ie],["__scopeId","data-v-3288ba28"]]);var oe=te,re={components:{EditFormSolicitud:oe,NavBar:I},data(){return{userName:"",userType:"",id_broker:null,id_inmobiliaria:null,tasks:[],showOverlay:!1,isEditing:!1,brokers:[],inmobiliarias:[],propiedades:[],clientes:[],editSolicitudId:null,newSolicitud:{tipo:"",id_cliente:null,id_broker:null,id_inmobiliaria:null,id_propiedad:null}}},async created(){const i=JSON.parse(localStorage.getItem("user"));i&&i.id?(await this.fetchUserData(i.id),await this.fetchDropdownData(),await this.fetchSolicitudes()):this.$router.push({name:"Login"})},methods:{viewSolicitud(i){this.$router.push({name:"DetalleSolicitud",params:{id_solicitud:i}})},async fetchUserData(i){try{const{data:e,error:t}=await k.from("broker").select("*").eq("user_id",i).single();if(t)throw t;if(e)return this.userName=e.nombre,this.userType="Broker",void(this.id_broker=e.id_broker)}catch(e){console.error("Error fetching user data:",e.message)}try{const{data:e,error:t}=await k.from("inmobiliaria").select("*").eq("user_id",i).single();if(t)throw t;e&&(this.userName=e.nombre,this.userType="Inmobiliaria",this.id_inmobiliaria=e.id_inmobiliaria,this.newSolicitud.id_inmobiliaria=e.id_inmobiliaria)}catch(e){console.error("Error fetching user data:",e.message)}},async fetchDropdownData(){try{const{data:i,error:e}=await k.from("broker").select("id_broker, nombre");if(e)throw e;this.brokers=i;const{data:t,error:o}=await k.from("inmobiliaria").select("id_inmobiliaria, nombre");if(o)throw o;this.inmobiliarias=t;const{data:r,error:a}=await k.from("propiedad").select("id_propiedad, titulo, id_inmobiliaria");if(a)throw a;this.propiedades=r;const{data:l}=await k.from("cliente").select("id_cliente, nombre, apellido");this.clientes=l||[]}catch(i){console.error("Error fetching dropdown data:",i.message)}},async fetchSolicitudes(){try{let i=k.from("solicitud").select("*");"Broker"===this.userType?i=i.eq("id_broker",this.id_broker):"Inmobiliaria"===this.userType&&(i=i.eq("id_inmobiliaria",this.id_inmobiliaria));const{data:e,error:t}=await i;if(t)throw t;this.tasks=e.map((i=>{const e=this.clientes.find((e=>e.id_cliente===i.id_cliente)),t=this.brokers.find((e=>e.id_broker===i.id_broker)),o=this.inmobiliarias.find((e=>e.id_inmobiliaria===i.id_inmobiliaria)),r=this.propiedades.find((e=>e.id_propiedad===i.id_propiedad));return{id_solicitud:i.id_solicitud,fecha_solicitud:this.formatFecha(i.fecha_solicitud),estado:i.estado,tipo:i.tipo,broker_nombre:t?t.nombre:"",inmobiliaria_nombre:o?o.nombre:"",propiedad_titulo:r?r.titulo:"",cliente_nombre:e?`${e.nombre} ${e.apellido}`:""}}))}catch(i){console.error("Error fetching solicitudes:",i.message)}},openAddSolicitudForm(){this.newSolicitud={tipo:"",id_cliente:null,id_broker:"Broker"===this.userType?this.id_broker:null,id_inmobiliaria:"Inmobiliaria"===this.userType?this.id_inmobiliaria:null,id_propiedad:null},this.isEditing=!1,this.showOverlay=!0},editSolicitud(i){this.newSolicitud={tipo:i.tipo,id_cliente:i.cliente_id,id_broker:i.id_broker,id_inmobiliaria:i.id_inmobiliaria,id_propiedad:i.id_propiedad},this.editSolicitudId=i.id_solicitud,this.isEditing=!0,this.showOverlay=!0},async addSolicitud(i){try{const e={fecha_solicitud:new Date,estado:"Pendiente",tipo:i.tipo,id_cliente:i.cliente_id,id_broker:"Nuevo Cliente"===i.tipo?this.id_broker:i.id_broker,id_inmobiliaria:i.id_inmobiliaria,id_propiedad:i.id_propiedad},{data:t,error:o}=await k.from("solicitud").insert([e]);if(o)throw o;this.showOverlay=!1,await this.fetchSolicitudes()}catch(e){console.error("Error adding solicitud:",e.message)}},async updateSolicitud(i){try{const{error:e}=await k.from("solicitud").update({tipo:i.tipo,id_cliente:i.cliente_id,id_broker:i.id_broker,id_inmobiliaria:"Nuevo Cliente"===i.tipo?null:i.id_inmobiliaria,id_propiedad:"Nuevo Cliente"===i.tipo?null:i.id_propiedad}).eq("id_solicitud",this.editSolicitudId);if(e)throw e;this.showOverlay=!1,this.isEditing=!1,await this.fetchSolicitudes()}catch(e){console.error("Error updating solicitud:",e.message)}},async deleteSolicitud(i){try{const{error:e}=await k.from("solicitud").delete().eq("id_solicitud",i);if(e)throw e;await this.fetchSolicitudes()}catch(e){console.error("Error deleting solicitud:",e.message)}},formatFecha(i){return new Intl.DateTimeFormat("es-CL",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(i))}}};const ae=(0,n.A)(re,[["render",$i],["__scopeId","data-v-92d3e706"]]);var le=ae;const se={class:"clientes"},ne={class:"table-container"},de={class:"clientes-table"},ce=["onClick"],ue=["onClick"],pe={class:"add-client-container"};function me(i,e,t,o,a,l){const s=(0,r.g2)("NavBar"),n=(0,r.g2)("FormClienteOverlay");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(s),(0,r.Lk)("div",se,[(0,r.Lk)("div",ne,[e[3]||(e[3]=(0,r.Lk)("h2",null,"Clientes",-1)),(0,r.Lk)("table",de,[e[2]||(e[2]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"ID Cliente"),(0,r.Lk)("th",null,"Nombre"),(0,r.Lk)("th",null,"Apellido"),(0,r.Lk)("th",null,"Email"),(0,r.Lk)("th",null,"Teléfono"),(0,r.Lk)("th",null,"Dirección"),(0,r.Lk)("th",null,"Distrito"),(0,r.Lk)("th",null,"País"),(0,r.Lk)("th",null,"Acciones")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.clients,(i=>((0,r.uX)(),(0,r.CE)("tr",{key:i.id_cliente},[(0,r.Lk)("td",null,(0,v.v_)(i.id_cliente),1),(0,r.Lk)("td",null,(0,v.v_)(i.nombre),1),(0,r.Lk)("td",null,(0,v.v_)(i.apellido),1),(0,r.Lk)("td",null,(0,v.v_)(i.email),1),(0,r.Lk)("td",null,(0,v.v_)(i.telefono),1),(0,r.Lk)("td",null,(0,v.v_)(i.direccion),1),(0,r.Lk)("td",null,(0,v.v_)(i.distrito_nombre),1),(0,r.Lk)("td",null,(0,v.v_)(i.pais_nombre),1),(0,r.Lk)("td",null,[(0,r.Lk)("img",{src:Oi,alt:"Editar",title:"Editar",class:"action-icon",onClick:e=>l.editClient(i)},null,8,ce),(0,r.Lk)("img",{src:Xi,alt:"Eliminar",title:"Eliminar",class:"action-icon",onClick:e=>l.deleteClient(i.id_cliente)},null,8,ue)])])))),128))])])]),(0,r.Lk)("div",pe,[(0,r.Lk)("button",{class:"add-client-button",onClick:e[0]||(e[0]=(...i)=>l.openAddClientForm&&l.openAddClientForm(...i))},"Agregar Cliente")]),(0,r.bF)(n,{visible:a.showOverlay,isEditing:a.isEditing,clientData:a.selectedClient,distritos:a.distritos,paises:a.paises,onClose:e[1]||(e[1]=i=>a.showOverlay=!1),onAddClient:l.addClient,onUpdateClient:l.updateClient},null,8,["visible","isEditing","clientData","distritos","paises","onAddClient","onUpdateClient"])])],64)}const he={key:0,class:"overlay"},be={class:"overlay-content"},fe={class:"form-row"},ke={class:"form-row"},ve={class:"form-row"},_e={class:"form-row"},ge={class:"form-row"},Le={class:"form-row"},ye=["value"],we={class:"form-row"},Ce=["value"],Ee={class:"form-row form-actions"},Se={type:"submit"};function Ie(i,e,t,a,l,s){return t.visible?((0,r.uX)(),(0,r.CE)("div",he,[(0,r.Lk)("div",be,[(0,r.Lk)("h3",null,(0,v.v_)(t.isEditing?"Editar Cliente":"Agregar Cliente"),1),(0,r.Lk)("form",{onSubmit:e[8]||(e[8]=(0,o.D$)(((...i)=>s.handleSubmit&&s.handleSubmit(...i)),["prevent"])),class:"form-container"},[(0,r.Lk)("div",fe,[e[9]||(e[9]=(0,r.Lk)("label",null,"Nombre:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=i=>l.client.nombre=i),required:""},null,512),[[o.Jo,l.client.nombre]])]),(0,r.Lk)("div",ke,[e[10]||(e[10]=(0,r.Lk)("label",null,"Apellido:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>l.client.apellido=i),required:""},null,512),[[o.Jo,l.client.apellido]])]),(0,r.Lk)("div",ve,[e[11]||(e[11]=(0,r.Lk)("label",null,"Email:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email","onUpdate:modelValue":e[2]||(e[2]=i=>l.client.email=i),required:""},null,512),[[o.Jo,l.client.email]])]),(0,r.Lk)("div",_e,[e[12]||(e[12]=(0,r.Lk)("label",null,"Teléfono:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"tel","onUpdate:modelValue":e[3]||(e[3]=i=>l.client.telefono=i),required:""},null,512),[[o.Jo,l.client.telefono]])]),(0,r.Lk)("div",ge,[e[13]||(e[13]=(0,r.Lk)("label",null,"Dirección:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=i=>l.client.direccion=i),required:""},null,512),[[o.Jo,l.client.direccion]])]),(0,r.Lk)("div",Le,[e[14]||(e[14]=(0,r.Lk)("label",null,"Distrito:",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[5]||(e[5]=i=>l.client.id_distrito=i),required:""},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.distritos,(i=>((0,r.uX)(),(0,r.CE)("option",{key:i.id_distrito,value:i.id_distrito},(0,v.v_)(i.nombre_distrito),9,ye)))),128))],512),[[o.u1,l.client.id_distrito]])]),(0,r.Lk)("div",we,[e[15]||(e[15]=(0,r.Lk)("label",null,"País:",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>l.client.id_pais=i),required:""},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.paises,(i=>((0,r.uX)(),(0,r.CE)("option",{key:i.id_pais,value:i.id_pais},(0,v.v_)(i.nombre_pais),9,Ce)))),128))],512),[[o.u1,l.client.id_pais]])]),(0,r.Lk)("div",Ee,[(0,r.Lk)("button",Se,(0,v.v_)(t.isEditing?"Actualizar":"Agregar"),1),(0,r.Lk)("button",{type:"button",onClick:e[7]||(e[7]=(...i)=>s.closeOverlay&&s.closeOverlay(...i))},"Cancelar")])],32)])])):(0,r.Q3)("",!0)}var Ae={props:{visible:Boolean,isEditing:Boolean,clientData:Object,distritos:Array,paises:Array},data(){return{client:{nombre:"",apellido:"",email:"",telefono:"",direccion:"",id_distrito:null,id_pais:null}}},watch:{clientData:{immediate:!0,handler(i){i&&this.isEditing?this.client={...i}:this.isEditing||(this.client={nombre:"",apellido:"",email:"",telefono:"",direccion:"",id_distrito:null,id_pais:null})}}},methods:{handleSubmit(){this.$emit(this.isEditing?"update-client":"add-client",this.client)},closeOverlay(){this.$emit("close")}}};const Fe=(0,n.A)(Ae,[["render",Ie],["__scopeId","data-v-c0fb3204"]]);var Oe=Fe,Ue={components:{NavBar:I,FormClienteOverlay:Oe},data(){return{userName:"",userType:"",id_broker:null,clients:[],showOverlay:!1,isEditing:!1,selectedClient:null,brokers:[],distritos:[],paises:[]}},async created(){const i=JSON.parse(localStorage.getItem("user"));i&&i.id?(await this.fetchUserData(i.id),await this.fetchDropdownData(),await this.fetchClients()):this.$router.push({name:"Login"})},methods:{async fetchUserData(i){try{const{data:e,error:t}=await k.from("broker").select("*").eq("user_id",i).single();if(t)throw t;e&&(this.userName=e.nombre,this.userType="Broker",this.id_broker=e.id_broker)}catch(e){console.error("Error fetching user data:",e.message)}},async fetchDropdownData(){try{const{data:i}=await k.from("distrito").select("id_distrito, nombre_distrito"),{data:e}=await k.from("pais").select("id_pais, nombre_pais");this.distritos=i||[],this.paises=e||[]}catch(i){console.error("Error fetching dropdown data:",i.message)}},async fetchClients(){try{const{data:i,error:e}=await k.from("cliente").select("\n              id_cliente, nombre, apellido, email, telefono, direccion,\n              id_distrito (nombre_distrito),\n              id_pais (nombre_pais)\n            ").eq("broker_asociado",this.id_broker);if(e)throw e;this.clients=i.map((i=>({id_cliente:i.id_cliente,nombre:i.nombre,apellido:i.apellido,email:i.email,telefono:i.telefono,direccion:i.direccion,id_distrito:i.id_distrito?i.id_distrito:null,id_pais:i.id_pais?i.id_pais:null,distrito_nombre:i.id_distrito?i.id_distrito.nombre_distrito:"",pais_nombre:i.id_pais?i.id_pais.nombre_pais:""})))}catch(i){console.error("Error fetching clients:",i.message)}},openAddClientForm(){this.selectedClient={nombre:"",apellido:"",email:"",telefono:"",direccion:"",id_distrito:null,id_pais:null},this.isEditing=!1,this.showOverlay=!0},editClient(i){this.selectedClient={...i},this.isEditing=!0,this.showOverlay=!0},async addClient(i){try{const e={nombre:i.nombre,apellido:i.apellido,email:i.email,telefono:i.telefono,direccion:i.direccion,id_distrito:i.id_distrito,id_pais:i.id_pais,broker_asociado:this.id_broker},{data:t,error:o}=await k.from("cliente").insert([e]);if(o)throw o;this.showOverlay=!1,await this.fetchClients()}catch(e){console.error("Error adding client:",e.message)}},async updateClient(i){try{const{error:e}=await k.from("cliente").update({nombre:i.nombre,apellido:i.apellido,email:i.email,telefono:i.telefono,direccion:i.direccion,id_distrito:i.id_distrito,id_pais:i.id_pais}).eq("id_cliente",i.id_cliente);if(e)throw e;this.showOverlay=!1,this.isEditing=!1,await this.fetchClients()}catch(e){console.error("Error updating client:",e.message)}},async deleteClient(i){try{const{error:e}=await k.from("cliente").delete().eq("id_cliente",i);if(e)throw e;await this.fetchClients()}catch(e){console.error("Error deleting client:",e.message)}},async logout(){const{error:i}=await k.auth.signOut();i?console.error("Error al cerrar sesión:",i.message):(localStorage.removeItem("user"),this.$router.push({name:"Login"}))}}};const Xe=(0,n.A)(Ue,[["render",me],["__scopeId","data-v-6c126fb0"]]);var qe=Xe;const De={class:"detalle-solicitud"},Ne={key:0,class:"card"},Te={class:"card-section"},Re={class:"card-section"},Pe={class:"card-section"},ze={class:"action-buttons"},$e={class:"archivos-section"},Je={class:"archivos-table"},Ve=["href"];function We(i,e,t,o,a,l){const s=(0,r.g2)("NavBar"),n=(0,r.g2)("UploadFileOverlay"),d=(0,r.g2)("RechazoOverlay");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(s),(0,r.Lk)("div",De,[e[25]||(e[25]=(0,r.Lk)("h2",{class:"detalle-solicitud-title"},"Detalles de la Solicitud",-1)),a.solicitud?((0,r.uX)(),(0,r.CE)("div",Ne,[(0,r.Lk)("div",Te,[e[11]||(e[11]=(0,r.Lk)("h3",null,"Información de la Solicitud",-1)),(0,r.Lk)("p",null,[e[7]||(e[7]=(0,r.Lk)("strong",null,"ID Solicitud:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.id_solicitud),1)]),(0,r.Lk)("p",null,[e[8]||(e[8]=(0,r.Lk)("strong",null,"Fecha:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.fecha_solicitud),1)]),(0,r.Lk)("p",null,[e[9]||(e[9]=(0,r.Lk)("strong",null,"Estado:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.estado),1)]),(0,r.Lk)("p",null,[e[10]||(e[10]=(0,r.Lk)("strong",null,"Tipo:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.tipo),1)])]),(0,r.Lk)("div",Re,[e[18]||(e[18]=(0,r.Lk)("h3",null,"Cliente",-1)),(0,r.Lk)("p",null,[e[12]||(e[12]=(0,r.Lk)("strong",null,"Nombre:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.cliente_nombre),1)]),(0,r.Lk)("p",null,[e[13]||(e[13]=(0,r.Lk)("strong",null,"Email:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.cliente_email),1)]),(0,r.Lk)("p",null,[e[14]||(e[14]=(0,r.Lk)("strong",null,"Teléfono:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.cliente_telefono),1)]),(0,r.Lk)("p",null,[e[15]||(e[15]=(0,r.Lk)("strong",null,"Dirección:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.cliente_direccion),1)]),(0,r.Lk)("p",null,[e[16]||(e[16]=(0,r.Lk)("strong",null,"Distrito:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.cliente_distrito),1)]),(0,r.Lk)("p",null,[e[17]||(e[17]=(0,r.Lk)("strong",null,"País:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.cliente_pais),1)])]),(0,r.Lk)("div",Pe,[e[22]||(e[22]=(0,r.Lk)("h3",null,"Información Adicional",-1)),(0,r.Lk)("p",null,[e[19]||(e[19]=(0,r.Lk)("strong",null,"Broker:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.broker_nombre),1)]),(0,r.Lk)("p",null,[e[20]||(e[20]=(0,r.Lk)("strong",null,"Inmobiliaria:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.inmobiliaria_nombre),1)]),(0,r.Lk)("p",null,[e[21]||(e[21]=(0,r.Lk)("strong",null,"Propiedad:",-1)),(0,r.eW)(" "+(0,v.v_)(a.solicitud.propiedad_titulo),1)])])])):(0,r.Q3)("",!0),(0,r.Lk)("div",ze,[(0,r.Lk)("button",{onClick:e[0]||(e[0]=(...i)=>l.takeRequest&&l.takeRequest(...i)),class:"action-button"},"Tomar Solicitud"),(0,r.Lk)("button",{onClick:e[1]||(e[1]=(...i)=>l.approveRequest&&l.approveRequest(...i)),class:"action-button"},"Aprobar Solicitud"),(0,r.Lk)("button",{onClick:e[2]||(e[2]=i=>a.showRechazoOverlay=!0),class:"action-button"},"Rechazar Solicitud"),(0,r.Lk)("button",{onClick:e[3]||(e[3]=i=>a.showOverlay=!0),class:"action-button"},"Agregar Archivo")]),a.showOverlay?((0,r.uX)(),(0,r.Wv)(n,{key:1,idSolicitud:a.solicitud.id_solicitud,onClose:e[4]||(e[4]=i=>a.showOverlay=!1),onFileUploaded:l.fetchArchivos},null,8,["idSolicitud","onFileUploaded"])):(0,r.Q3)("",!0),(0,r.Lk)("div",$e,[e[24]||(e[24]=(0,r.Lk)("h3",null,"Archivos Asociados a la Solicitud",-1)),(0,r.Lk)("table",Je,[e[23]||(e[23]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"Archivo"),(0,r.Lk)("th",null,"Acciones")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.archivos,(i=>((0,r.uX)(),(0,r.CE)("tr",{key:i.id},[(0,r.Lk)("td",null,(0,v.v_)(i.nombre),1),(0,r.Lk)("td",null,[(0,r.Lk)("a",{href:i.url,target:"_blank",class:"download-link"},"Descargar",8,Ve)])])))),128))])])]),a.showOverlay?((0,r.uX)(),(0,r.Wv)(n,{key:2,idSolicitud:a.solicitud.id_solicitud,onClose:e[5]||(e[5]=i=>a.showOverlay=!1),onFileUploaded:l.fetchArchivos},null,8,["idSolicitud","onFileUploaded"])):(0,r.Q3)("",!0),a.showRechazoOverlay?((0,r.uX)(),(0,r.Wv)(d,{key:3,onClose:e[6]||(e[6]=i=>a.showRechazoOverlay=!1),onRechazoSubmitted:l.handleRechazo},null,8,["onRechazoSubmitted"])):(0,r.Q3)("",!0)])],64)}const Me={class:"upload-overlay"},je={class:"overlay-content"},Be=["disabled"];function xe(i,e,t,o,a,l){return(0,r.uX)(),(0,r.CE)("div",Me,[(0,r.Lk)("div",je,[e[3]||(e[3]=(0,r.Lk)("h3",null,"Subir Archivo",-1)),(0,r.Lk)("input",{type:"file",onChange:e[0]||(e[0]=(...i)=>l.handleFileChange&&l.handleFileChange(...i))},null,32),(0,r.Lk)("button",{onClick:e[1]||(e[1]=(...i)=>l.uploadFile&&l.uploadFile(...i)),disabled:!a.archivo},"Subir",8,Be),(0,r.Lk)("button",{onClick:e[2]||(e[2]=e=>i.$emit("close"))},"Cancelar")])])}var Qe={props:["idSolicitud"],data(){return{archivo:null}},methods:{handleFileChange(i){this.archivo=i.target.files[0]},sanitizeFileName(i){return i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]/g,"_")},async uploadFile(){if(!this.archivo)return;const i=this.sanitizeFileName(this.archivo.name),e=`uploads/${this.idSolicitud}/${Date.now()}_${i}`;try{const{data:i,error:t}=await k.storage.from("Archivos").upload(e,this.archivo);if(t)throw t;const o=k.storage.from("Archivos").getPublicUrl(e).data.publicUrl,{error:r}=await k.from("Archivos").insert([{id_solicitud:this.idSolicitud,url:o}]);if(r)throw r;alert("Archivo subido y registrado exitosamente."),this.$emit("fileUploaded")}catch(t){console.error("Error al subir el archivo:",t.message),alert("Error al subir el archivo. Intente nuevamente.")}}}};const Ke=(0,n.A)(Qe,[["render",xe],["__scopeId","data-v-5d611486"]]);var Ze=Ke;const Ge={class:"overlay"},Ye={class:"overlay-content"},He={class:"buttons"};function it(i,e,t,a,l,s){return(0,r.uX)(),(0,r.CE)("div",Ge,[(0,r.Lk)("div",Ye,[e[3]||(e[3]=(0,r.Lk)("h3",null,"Rechazar Solicitud",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":e[0]||(e[0]=i=>l.comentario=i),placeholder:"Escriba el motivo del rechazo..."},null,512),[[o.Jo,l.comentario]]),(0,r.Lk)("div",He,[(0,r.Lk)("button",{onClick:e[1]||(e[1]=(...i)=>s.submitRechazo&&s.submitRechazo(...i))},"Confirmar"),(0,r.Lk)("button",{onClick:e[2]||(e[2]=e=>i.$emit("close"))},"Cancelar")])])])}var et={data(){return{comentario:""}},methods:{submitRechazo(){this.$emit("rechazoSubmitted",this.comentario),this.$emit("close")}}};const tt=(0,n.A)(et,[["render",it],["__scopeId","data-v-7ec49e84"]]);var ot=tt,rt={components:{NavBar:I,RechazoOverlay:ot,UploadFileOverlay:Ze},props:["id_solicitud"],data(){return{solicitud:null,archivos:[],userType:JSON.parse(localStorage.getItem("user")).type,userId:JSON.parse(localStorage.getItem("user")).id,showOverlay:!1,showRechazoOverlay:!1}},async created(){await this.fetchSolicitudDetails(),await this.fetchArchivos()},methods:{async fetchSolicitudDetails(){try{const{data:i,error:e}=await k.from("solicitud").select("\n              id_solicitud, fecha_solicitud, estado, tipo,\n              id_inmobiliaria, id_cliente,\n              cliente:id_cliente (\n                nombre, apellido, email, telefono, direccion,\n                distrito:id_distrito(nombre_distrito),\n                pais:id_pais(nombre_pais)\n              ),\n              broker:id_broker (nombre),\n              inmobiliaria:id_inmobiliaria (nombre),\n              propiedad:id_propiedad (titulo)\n            ").eq("id_solicitud",this.id_solicitud).single();if(e)throw e;this.solicitud={id_solicitud:i.id_solicitud,fecha_solicitud:i.fecha_solicitud,estado:i.estado,tipo:i.tipo,id_inmobiliaria:i.id_inmobiliaria,id_cliente:i.id_cliente,cliente_nombre:i.cliente?`${i.cliente.nombre} ${i.cliente.apellido}`:"",cliente_email:i.cliente?i.cliente.email:"",cliente_telefono:i.cliente?i.cliente.telefono:"",cliente_direccion:i.cliente?i.cliente.direccion:"",cliente_distrito:i.cliente?i.cliente.distrito.nombre_distrito:"",cliente_pais:i.cliente?i.cliente.pais.nombre_pais:"",broker_nombre:i.broker?i.broker.nombre:"",inmobiliaria_nombre:i.inmobiliaria?i.inmobiliaria.nombre:"",propiedad_titulo:i.propiedad?i.propiedad.titulo:""}}catch(i){console.error("Error fetching solicitud details:",i.message)}},async fetchArchivos(){try{const{data:i,error:e}=await k.from("Archivos").select("id, url").eq("id_solicitud",this.id_solicitud);if(e)throw e;this.archivos=i.map((i=>({id:i.id,url:i.url,nombre:i.url.split("/").pop()})))}catch(i){console.error("Error fetching archivos:",i.message)}},async takeRequest(){await this.updateSolicitudEstado("En Proceso")},async approveRequest(){"Nuevo Cliente"===this.solicitud.tipo&&await this.updateClientApprovalStatus(!0),await this.updateSolicitudEstado("Aprobada")},async rejectRequest(){"Nuevo Cliente"===this.solicitud.tipo&&await this.updateClientApprovalStatus(!1),await this.updateSolicitudEstado("Rechazado")},async updateClientApprovalStatus(i){try{const{error:e}=await k.from("cliente").update({Aprobado_Inmobiliaria:i}).eq("id_cliente",this.solicitud.id_cliente);if(e)throw e;alert(`El cliente ha sido ${i?"aprobado":"desaprobado"} exitosamente.`)}catch(e){console.error("Error al actualizar el estado de aprobación del cliente:",e.message)}},async updateSolicitudEstado(i){try{const{error:e}=await k.from("solicitud").update({estado:i}).eq("id_solicitud",this.solicitud.id_solicitud);if(e)throw e;this.solicitud.estado=i,alert(`La solicitud ha sido actualizada a: ${i}`)}catch(e){console.error("Error al actualizar el estado de la solicitud:",e.message)}},handleFileUploaded(){this.showOverlay=!1,this.fetchArchivos(),alert("Archivo subido y guardado correctamente.")},async rejectRequest(i){try{const{error:e}=await k.from("solicitud").update({estado:"Rechazado",comentario_rechazo:i}).eq("id_solicitud",this.solicitud.id_solicitud);if(e)throw e;this.solicitud.estado="Rechazado",alert("La solicitud ha sido rechazada.")}catch(e){console.error("Error al rechazar la solicitud:",e.message)}},handleRechazo(i){this.rejectRequest(i),this.showRechazoOverlay=!1}}};const at=(0,n.A)(rt,[["render",We],["__scopeId","data-v-12dbddc9"]]);var lt=at;const st=[{path:"/",name:"Login",component:$},{path:"/home",name:"Home",component:O},{path:"/registro",name:"Registro",component:Z},{path:"/registroc",name:"RegistroC",component:hi},{path:"/marketplace",name:"MarketPlace",component:Fi},{path:"/solicitudes",name:"Solicitudes",component:le},{path:"/clientes",name:"Clientes",component:qe},{path:"/solicitud/:id_solicitud",name:"DetalleSolicitud",component:lt,props:!0}],nt=(0,u.aE)({history:(0,u.LA)(),routes:st});var dt=nt;t(777);(0,o.Ef)(c).use(dt).mount("#app")}},e={};function t(o){var r=e[o];if(void 0!==r)return r.exports;var a=e[o]={exports:{}};return i[o].call(a.exports,a,a.exports,t),a.exports}t.m=i,function(){var i=[];t.O=function(e,o,r,a){if(!o){var l=1/0;for(c=0;c<i.length;c++){o=i[c][0],r=i[c][1],a=i[c][2];for(var s=!0,n=0;n<o.length;n++)(!1&a||l>=a)&&Object.keys(t.O).every((function(i){return t.O[i](o[n])}))?o.splice(n--,1):(s=!1,a<l&&(l=a));if(s){i.splice(c--,1);var d=r();void 0!==d&&(e=d)}}return e}a=a||0;for(var c=i.length;c>0&&i[c-1][2]>a;c--)i[c]=i[c-1];i[c]=[o,r,a]}}(),function(){t.n=function(i){var e=i&&i.__esModule?function(){return i["default"]}:function(){return i};return t.d(e,{a:e}),e}}(),function(){var i,e=Object.getPrototypeOf?function(i){return Object.getPrototypeOf(i)}:function(i){return i.__proto__};t.t=function(o,r){if(1&r&&(o=this(o)),8&r)return o;if("object"===typeof o&&o){if(4&r&&o.__esModule)return o;if(16&r&&"function"===typeof o.then)return o}var a=Object.create(null);t.r(a);var l={};i=i||[null,e({}),e([]),e(e)];for(var s=2&r&&o;"object"==typeof s&&!~i.indexOf(s);s=e(s))Object.getOwnPropertyNames(s).forEach((function(i){l[i]=function(){return o[i]}}));return l["default"]=function(){return o},t.d(a,l),a}}(),function(){t.d=function(i,e){for(var o in e)t.o(e,o)&&!t.o(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:e[o]})}}(),function(){t.f={},t.e=function(i){return Promise.all(Object.keys(t.f).reduce((function(e,o){return t.f[o](i,e),e}),[]))}}(),function(){t.u=function(i){return"js/"+i+".5b49bf8e.js"}}(),function(){t.miniCssF=function(i){}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(i){if("object"===typeof window)return window}}()}(),function(){t.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)}}(),function(){var i={},e="frontend:";t.l=function(o,r,a,l){if(i[o])i[o].push(r);else{var s,n;if(void 0!==a)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==e+a){s=u;break}}s||(n=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,t.nc&&s.setAttribute("nonce",t.nc),s.setAttribute("data-webpack",e+a),s.src=o),i[o]=[r];var p=function(e,t){s.onerror=s.onload=null,clearTimeout(m);var r=i[o];if(delete i[o],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((function(i){return i(t)})),e)return e(t)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),n&&document.head.appendChild(s)}}}(),function(){t.r=function(i){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})}}(),function(){t.p="/"}(),function(){var i={524:0};t.f.j=function(e,o){var r=t.o(i,e)?i[e]:void 0;if(0!==r)if(r)o.push(r[2]);else{var a=new Promise((function(t,o){r=i[e]=[t,o]}));o.push(r[2]=a);var l=t.p+t.u(e),s=new Error,n=function(o){if(t.o(i,e)&&(r=i[e],0!==r&&(i[e]=void 0),r)){var a=o&&("load"===o.type?"missing":o.type),l=o&&o.target&&o.target.src;s.message="Loading chunk "+e+" failed.\n("+a+": "+l+")",s.name="ChunkLoadError",s.type=a,s.request=l,r[1](s)}};t.l(l,n,"chunk-"+e,e)}},t.O.j=function(e){return 0===i[e]};var e=function(e,o){var r,a,l=o[0],s=o[1],n=o[2],d=0;if(l.some((function(e){return 0!==i[e]}))){for(r in s)t.o(s,r)&&(t.m[r]=s[r]);if(n)var c=n(t)}for(e&&e(o);d<l.length;d++)a=l[d],t.o(i,a)&&i[a]&&i[a][0](),i[a]=0;return t.O(c)},o=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=t.O(void 0,[504],(function(){return t(520)}));o=t.O(o)})();
//# sourceMappingURL=app.8937e4a5.js.map